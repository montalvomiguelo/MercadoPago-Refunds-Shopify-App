<h4><%= @order.name %></h4>
<form action="/orders/<%= @order.id %>/refunds/calculate" method="post">

  <table class="u-full-width">
    <thead>
      <tr>
        <th>Title</th>
        <th>Cost</th>
        <th colspan="2">Qty</th>
      </tr>
    </thead>
    <tfoot>
      <% @order.discount_codes.each do |discount_code| %>
        <tr>
          <td>
            <strong>Discount</strong>
            <br>
            <small><%= discount_code.code %></small>
          </td>
          <td colspan="4">
            <%= discount_code.amount %>
          </td>
        </tr>
      <% end %>
      <tr>
        <td>
          <strong>Subtotal</strong>
          <td colspan="4">
            <%= @order.subtotal_price %>
          </td>
        </td>
      </tr>
      <% @order.shipping_lines.each do |shipping_line| %>
        <tr>
          <td>
            <strong>Shipping</strong>
          </td>
          <td colspan="4">
            <%= shipping_line.price %>
          </td>
        </tr>
      <% end %>
      <tr>
        <td>
          <strong>Tax</strong>
          <% if @order.taxes_included %>
            <br>
            <small>Included</small>
          <% end %>
        </td>
        <td colspan="4"><%= @order.total_tax %></td>
      </tr>
      <tr>
        <td>
          <strong>Total</strong>
        </td>
        <td colspan="4"><%= @order.total_price %></td>
      </tr>
      <tr>
        <td>
          <strong>Refund</strong>
        </td>
        <td colspan="4"><%= @order.total_refund %></td>
      </tr>
    </tfoot>
    <tbody>
      <% @order.line_items.each do |line_item| %>
        <tr>
          <td>
            <%= line_item.title %>
            <br>
            <small><%= line_item.variant_title %></small>
          </td>
          <td>
            <%= line_item.price %>
          </td>
          <td><%= line_item.quantity %></td>
          <td>
            <% if @order.refunds_for_line_item(line_item) < line_item.quantity %>
              <input type="hidden" name="refund[refund_line_items][][line_item_id]" value="<%= line_item.id %>">
              <input name="refund[refund_line_items][][quantity]" type="number" min="0" max="<%= line_item.quantity - @order.refunds_for_line_item(line_item) %>" value="0">
            <% else %>
              <span>Already returned</span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <label for="shipping">Shipping</label>
  <input id="shipping" class="u-full-width" type="text" name="refund[shipping][amount]" placeholder="Shipping" value="0">

  <input class="button-primary" type="submit" value="Calculate">
</form>
